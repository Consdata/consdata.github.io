I"A<p>Nieatwo znale藕 wym贸wk, 偶eby nie pisa test贸w jednostkowych. Obecno framework贸w uatwiajcych t czynno w projektach, z kt贸rymi stykamy si na co dzie, nie powinna na 偶adnym chocia偶 troch dowiadczonym programicie robi wra偶enia i nie trzeba go przekonywa, 偶e <strong>jedne z wielu zalet pisania test贸w jednostkowych</strong>, to:</p>
<ul>
  <li>zmuszenie tw贸rcy do zastanowienia si nad zadaniem sprawdzanego kodu (co mo偶e potencjalnie poprawi design aplikacji),</li>
  <li>uatwienie wczesnego wyapywania bd贸w,</li>
  <li>ekspozycja przypadk贸w brzegowych,</li>
  <li>uatwienie zrozumienia dziaania kodu osobom, kt贸re go nie tworzyy.</li>
</ul>

<p>W wielu nowoczesnych aplikacjach internetowych, w tym np. we wnioskach Eximee, <strong>du偶a cz logiki znajduje si po stronie klienckiej</strong>, hipokryzj byoby pominicie test贸w w tak istotnym elemencie aplikacji, poniewa偶 najbardziej rzucajce si w oczy bdy s wanie tam. Niemniej nawet przy ogromnej liczbie narzdzi wspomagajcych proces pisania test贸w jednostkowych, programici mog mie problem z <strong>wyznaczeniem wanie tych jednostek</strong>.</p>
<h2 id="co-testowa">Co testowa</h2>
<p>Niezale偶nie od tego jaki framework zosta u偶yty w danym projekcie, zawsze mo偶emy z niego wydzieli komponenty. Przewa偶nie jest to JavaScriptowa klasa z jakim odniesieniem do szablonu HTML. Akurat w tym artykule jako przykad u偶yty zosta Angular. W praktyce mo偶emy podzieli te komponenty na dwa typy:</p>
<ul>
  <li><strong>komponent prezentacyjny</strong>, kt贸ry <strong>nie posiada logiki biznesowej</strong> i jego jedynymi zadaniami s wywietlenie szablonu na podstawie wejcia i ew. przekazanie jakiego zdarzenia (np. kliknicia, wcinicia klawisza itp.) do komponentu nadrzdnego,</li>
  <li>komponent, kt贸ry <strong>u偶ywa i zarzdza innymi komponentami</strong> nie zajmujc si jednoczenie prezentacj.</li>
</ul>

<p>Brak tego podziau mo偶e znaczco utrudni pisanie test贸w jednostkowych, co zreszt oka偶e si bardzo szybko przy pr贸bie napisania ich do sabo zaprojektowanego komponentu.
Uwa偶am, 偶e testy jednostkowe komponent贸w prezentacyjnych s zasadne tylko w przypadku, gdy wejcie w jaki spos贸b zmienia jego zachowanie lub obsuga uaktualnienia widoku jest skomplikowana (np. animacja przeliczajc atrybuty elementu w locie). <strong>Najwa偶niejsze jest zwikszenie pokrycia logiki biznesowej.</strong></p>

<h2 id="testowanie-logiki-biznesowej">Testowanie logiki biznesowej</h2>
<p>W pierwszej kolejnoci powinnimy si zastanowi nad tym, czy z komponentu mo偶emy wydzieli logik, np. do osobnego serwisu, czyli w praktyce klasy odpowiedzialnej za jak funkcjonalno z mo偶liwoci u偶ywania jej w wielu miejsciach (np. serwis zarzdzajcy widocznoci popup贸w w aplikacji). Serwisy testuje si o wiele prociej ni偶 komponenty, ze wzgldu na brak szablonu i zwizanego z frameworkiem narzutu (serwis mo偶e byzwyk JavaScriptow klas).</p>

<h2 id="praktyka-na-przykadzie-jasmine-i-angulara">Praktyka na przykadzie Jasmine i Angulara</h2>
<p>Niech przykadem bdzie komponent wyboru daty z formatterem - zakadajc, 偶e caa logika znajduje si w komponencie, trzeba bdzie zadba o stworzenie jego instancji ze wszystkimi zale偶nociami piszc testy dla formattera, nastpnie zasymulowa zdarzenie wpisania danych w pole tekstowe. Gdyby wydzielono wczeniej osobny serwis do formatowania, to wystarczyoby przetestowa tylko jego logik. Testy caego komponentu mo偶emy przeprowadzi zalepiajc odpowiednie zale偶noci, co znacznie uatwi prac.
Tak wygldaby komponent, jeli zaniedbalibymy wy偶ej zaproponowany podzia:</p>

<h3 id="komponent">Komponent</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">date-picker</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">template</span><span class="p">:</span> <span class="s2">`</span><span class="err">
        &lt;input [value]="formattedValue" (change)="onValueChange(</span><span class="s2">$</span><span class="err">event.target.value)"&gt;
    </span><span class="s2">`</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">DatePicker</span> <span class="k">implements</span> <span class="nx">OnChanges</span>  <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">formattedValue</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">datePickerRestService</span><span class="p">:</span> <span class="nx">DatePickerRestService</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
    
    <span class="nx">ngOnChanges</span><span class="p">(</span><span class="nx">changes</span><span class="p">:</span> <span class="nx">SimpleChanges</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">formattedValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">changes</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">currentValue</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="nx">onValueChange</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="nx">format</span><span class="p">(</span><span class="kr">string</span><span class="p">:</span> <span class="nx">value</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="nx">sendValue</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
       <span class="k">this</span><span class="p">.</span><span class="nx">datePickerRestService</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="test">Test</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">fixture</span><span class="p">:</span> <span class="nx">ComponentFixture</span><span class="o">&lt;</span><span class="nx">DatePicker</span><span class="o">&gt;</span><span class="p">;</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">DatePicker</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">class</span> <span class="nx">DatePickerRestServiceMock</span> <span class="k">implements</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">DatePickerRestService</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nx">send</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
            <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">DatePicker</span><span class="p">],</span>
            <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                  <span class="na">provide</span><span class="p">:</span> <span class="nx">DatePickerRestService</span><span class="p">,</span>
                  <span class="na">useClass</span><span class="p">:</span> <span class="nx">DatePickerRestServiceMock</span>
              <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">});</span>
        <span class="nx">fixture</span> <span class="o">=</span> <span class="nx">TestBed</span><span class="p">.</span><span class="nx">createComponent</span><span class="p">(</span><span class="nx">DatePicker</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should return formatted date from timestamp</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// given</span>
        <span class="kd">const</span> <span class="nx">hostElement</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">.</span><span class="nx">nativeElement</span><span class="p">;</span>
        <span class="kd">const</span> <span class="na">input</span><span class="p">:</span> <span class="nx">HTMLInputElement</span> <span class="o">=</span> <span class="nx">hostElement</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>

        <span class="c1">// when</span>
        <span class="nx">fixture</span><span class="p">.</span><span class="nx">componentInstance</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">2018-07-01</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">fixture</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>

        <span class="c1">// then</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">1 lipca 2018</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>
<p>Jak wida testy s sabo czytelne, poniewa偶 widoczne s detale implementacyjne zwizane z dziaaniem frameworku (TestBed, ComponentFixture). Wraz z dodawaniem funkcjonalnoci i zale偶noci coraz trudniej bdzie utrzyma klarowno.</p>

<p>Zaprojektowany w ten spos贸b komponent pozwoli na przetestowanie g贸wnej funkcjonalnoci nie przejmujc si zale偶nociami komponentu i jego szablonem.</p>

<h3 id="komponent-1">Komponent</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">date-picker</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">template</span><span class="p">:</span> <span class="s2">`</span><span class="err">
        &lt;date-picker-input [value]="formattedValue" (change)="onValueChange(</span><span class="s2">$</span><span class="err">event)"&gt;&lt;/date-picker-input&gt;
    </span><span class="s2">`</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">DatePicker</span> <span class="k">implements</span> <span class="nx">OnChanges</span>  <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">formattedValue</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">service</span><span class="p">:</span> <span class="nx">FormatterService</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
    
    <span class="nx">ngOnChanges</span><span class="p">(</span><span class="nx">changes</span><span class="p">:</span> <span class="nx">SimpleChanges</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">formattedValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">changes</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">currentValue</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">onValueChange</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Test serwisu formattera m贸gby wyglda nastpujco:</p>

<h3 id="test-1">Test</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">FormatterService</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

   <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormatterService</span><span class="p">();</span>
   <span class="p">});</span>

   <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should return formatted date from timestamp</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// given</span>
      <span class="kd">const</span> <span class="na">timestamp</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(</span><span class="dl">'</span><span class="s1">2018-07-01</span><span class="dl">'</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span> 

      <span class="c1">// when</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span>

      <span class="c1">// then</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">1 lipca 2018</span><span class="dl">'</span><span class="p">);</span>
   <span class="p">});</span>

<span class="p">});</span>
</code></pre></div></div>
<p>Nie trzeba si martwi o dodatkowe zale偶noci, mo偶na si skupi tylko na testowaniu funkcjonalnoci.</p>

<p>Jak wida przy odpowiednim podejciu pisanie test贸w jednostkowych funkcjonalnoci na frontendzie nie musi si tak bardzo r贸偶ni od tworzenia ich dla czci backendowej gdy wie si co i w jaki spos贸b testowa, wtedy samo pisanie test贸w staje sio wiele prostsze.</p>
:ET