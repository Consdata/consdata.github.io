<!DOCTYPE html>
<html lang="en">
<script src="/js/lunr.min.js"></script><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Keycloak - uwierzytelnianie i autoryzacja użytkownika w aplikacji Angular/Spring Boot | Consdata - blog techniczny</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Keycloak - uwierzytelnianie i autoryzacja użytkownika w aplikacji Angular/Spring Boot" />
<meta name="author" content="mhoja" />
<meta property="og:locale" content="pl" />
<meta name="description" content="Jak wykorzystać serwer Keycloak do logowania w aplikacji? Omówimy to na przykładzie gotowego projektu, który umożliwia użytkownikowi zalogowanie się do aplikacji z poziomu przeglądarki internetowej." />
<meta property="og:description" content="Jak wykorzystać serwer Keycloak do logowania w aplikacji? Omówimy to na przykładzie gotowego projektu, który umożliwia użytkownikowi zalogowanie się do aplikacji z poziomu przeglądarki internetowej." />
<link rel="canonical" href="https://blog.consdata.tech/en/2020/02/01/keycloak-user-authentication-authorization-springboot-angular.html" />
<meta property="og:url" content="https://blog.consdata.tech/2020/02/01/keycloak-user-authentication-authorization-springboot-angular.html" />
<meta property="og:site_name" content="Consdata - blog techniczny" />
<meta property="og:image" content="https://blog.consdata.tech/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/thumbnail.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-01T01:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.consdata.tech/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/thumbnail.webp" />
<meta property="twitter:title" content="Keycloak - uwierzytelnianie i autoryzacja użytkownika w aplikacji Angular/Spring Boot" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"mhoja"},"image":"https://blog.consdata.tech/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/thumbnail.webp","@type":"BlogPosting","headline":"Keycloak - uwierzytelnianie i autoryzacja użytkownika w aplikacji Angular/Spring Boot","description":"Jak wykorzystać serwer Keycloak do logowania w aplikacji? Omówimy to na przykładzie gotowego projektu, który umożliwia użytkownikowi zalogowanie się do aplikacji z poziomu przeglądarki internetowej.","dateModified":"2020-02-01T01:00:00-06:00","datePublished":"2020-02-01T01:00:00-06:00","url":"https://blog.consdata.tech/2020/02/01/keycloak-user-authentication-authorization-springboot-angular.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.consdata.tech/2020/02/01/keycloak-user-authentication-authorization-springboot-angular.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,700,600,500,300,200,100,800,900" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,600,500,300,200,100,800,900" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;400;500;700&display=swap" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.consdata.tech/en/feed.xml" title="Consdata - blog techniczny" /><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NFV6DPR');</script>

    
    
    
      
        <link rel="alternate" hreflang="en" href="/en/2020/02/01/keycloak-user-authentication-and-authorization-springboot-angular.html"/>
      
        <link rel="alternate" hreflang="pl" href="/en/2020/02/01/keycloak-user-authentication-authorization-springboot-angular.html"/>
      
    
  

  <link rel="icon" type="image/x-icon" href="/en/favicon.ico">
</head>
<body><nav class="site-header">
    <div class="container">
        <div class="header navbar-default" role="navigation">
            <div class="header-brand">
                <a class="header-logo" href="/en/">
                    <img src="/assets/img/logo.png" alt="consdata.com">
                </a>
                <div class="mobile-search">
                    
<form action="/en/search.html" method="get">

    <div class="search-input-container">
        <input type="text" placeholder="Find an article..." id="search-box-mobile" name="query" class="search-input" autocomplete="off">
        <i class="fa fa-search search-icon" onclick="expandInputMobile()"></i>
    </div>
</form>

<script>
    const inputMobile = document.getElementById("search-box-mobile");
    const logo = document.getElementById("header-logo");
    const expandInputMobile = () => {
        inputMobile.classList.toggle("expanded");
        logo.classList.toggle("header-logo");
        logo.classList.toggle("logo-invisible");
    };
</script>

                </div>
            </div>
            <div id="header-links">
                <div>
                    <a class="nav-link" href="/en/">Technical blog</a>
                    <a class="nav-link" href="https://consdata.com/pl/blog/biznesowy">Business blog</a>
                    <a class="nav-link" href="https://consdata.com/pl/blog/hr">HR department</a>
                </div>
                
                <a class="language-switch" onclick="navigate(' /2020/02/01/keycloak-user-authentication-authorization-springboot-angular.html')">PL</a>
                
            </div>

        </div>
    </div>
</nav>
<script>
    function navigate(baseUrl) {
        const queryParams = window.location.search;
        window.location.href = baseUrl + queryParams;
    }
</script>
<main class="page-content" aria-label="Content">
    


<div class="blog">
    <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="post-content-sidebar">
            <div class="post-content">
                <div class="badge">angular</div>
                <h1 class="post-big-title p-name" itemprop="name headline">Keycloak - uwierzytelnianie i autoryzacja użytkownika w aplikacji Angular/Spring Boot</h1>
                <div class="post-metadata">
    <div>
    <a class="author" href="/en/authors/mhoja.html">
        <img class="author-image" src="/assets/img/authors/mhoja.webp" alt="author">
        <span class="author-name">Michał Hoja</span><a class="author" href="https://github.com/Michuu93">
            <img class="github-icon" src="/assets/icon/github.svg">
        </a>
        
    </a>
</div>

    <div class="metadata">
        
        <span class="publish-date">
1


February


2020
</span>
    </div>
</div>

                <div itemprop="articleBody" class="post-content-container">
                    <div class="post-content-left-pane">
                        <div class="post-content">
                            <p>Jak wykorzystać serwer Keycloak do logowania w aplikacji?
Omówimy to na przykładzie gotowego projektu, który umożliwia użytkownikowi zalogowanie się do aplikacji z poziomu przeglądarki internetowej.</p>

<h2 id="czym-jest-keycloak">Czym jest Keycloak?</h2>

<p>Keycloak to serwer uwierzytelniania i autoryzacji na licencji open-source. Może zostać podłączony do LDAP/AD lub uwierzytelniać użytkowników przy użyciu Google, Facebooka itd.
Posiada również konsolę administracyjną, w której możemy łatwo skonfigurować chociażby uprawnienia użytkowników.</p>

<p>Więcej informacji na stronie <a href="https://www.keycloak.org/">www.keycloak.org</a>.</p>

<h2 id="projekt-demo">Projekt demo</h2>

<p>Projekt aplikacji znajduję się na GitHubie - <a href="https://github.com/Michuu93/spring-angular-keycloak">link do repozytorium.</a>
Składa się on z aplikacji backendowej napisanej w Spring Boot (Kotlin) oraz frontendowej napisanej w Angular 8.</p>

<p>Aby przedstawić sposób zaimplementowania uwierzytelniania użytkownika za pomocą serwera Keycloak, zabezpieczymy endpointy na backendzie oraz osobno część frontendową.</p>

<h3 id="serwer-keycloak">Serwer Keycloak</h3>

<p>Wykorzystamy serwer Keycloak uruchomiony na Dockerze. Wykonując w głównym folderze repozytorium polecenie:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--name</span> keycloak-server <span class="nt">-p</span> 8180:8080 <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">KEYCLOAK_USER</span><span class="o">=</span>admin <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">KEYCLOAK_PASSWORD</span><span class="o">=</span>admin <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">KEYCLOAK_IMPORT</span><span class="o">=</span>/realm/realm-export.json <span class="se">\</span>
    <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/realm/:/realm/ <span class="se">\</span>
    jboss/keycloak
</code></pre></div></div>

<p>uruchomimy serwer Keycloak na porcie <code class="language-plaintext highlighter-rouge">8180</code>.</p>

<p>Konsola administracyjna będzie dostępna pod adresem: <a href="http://127.0.0.1:8180/auth/admin/">127.0.0.1:8180/auth/admin</a>
Zalogujemy się do niej przy użyciu loginu i hasła zdefiniowanego w <code class="language-plaintext highlighter-rouge">KEYCLOAK_USER</code> oraz <code class="language-plaintext highlighter-rouge">KEYCLOAK_PASSWORD</code>, w naszym przypadku <code class="language-plaintext highlighter-rouge">admin:admin</code>.</p>

<h4 id="konfiguracja-serwera">Konfiguracja serwera</h4>

<p>Sama konfiguracja serwera Keycloak, to temat na osobny wpis, dlatego wykorzystamy przygotowaną wcześniej konfigurację.</p>

<p>Eksport konfiguracji serwera został umieszczony w repozytorium projektu demo (<code class="language-plaintext highlighter-rouge">realm/realm-export.json</code>) i zostanie załadowany podczas uruchomienia serwera.</p>

<p><strong>Skonfigurowane zostały:</strong></p>

<ul>
  <li>realm <code class="language-plaintext highlighter-rouge">SpringBootAngular</code></li>
  <li>client <code class="language-plaintext highlighter-rouge">SpringBootAngularClient</code>
    <ul>
      <li>Access Type: <code class="language-plaintext highlighter-rouge">confidential</code> - podczas logowania musimy przekazać secret skonfigurowany w <code class="language-plaintext highlighter-rouge">SpringBootAngularClient</code>
        <ul>
          <li>dostępnę są jeszcze opcje <code class="language-plaintext highlighter-rouge">bearer-only</code> oraz <code class="language-plaintext highlighter-rouge">public</code> - więcej na ten temat w dokumentacji <a href="https://www.keycloak.org/docs/latest/server_admin/#oidc-clients">(link)</a></li>
        </ul>
      </li>
      <li>Valid Redirect URIs: <code class="language-plaintext highlighter-rouge">*</code> - dla ułatwienia bez ograniczeń</li>
      <li>Web Origins: <code class="language-plaintext highlighter-rouge">*</code> - dla ułatwienia bez ograniczeń</li>
    </ul>
  </li>
  <li>rola <code class="language-plaintext highlighter-rouge">user_role</code> - tylko użytkownik z tą rolą będzie mógł się autoryzować w aplikacjach</li>
  <li>użytkownik <code class="language-plaintext highlighter-rouge">user</code> z rolą <code class="language-plaintext highlighter-rouge">user_role</code> (<code class="language-plaintext highlighter-rouge">user:password</code>)</li>
  <li>użytkownik <code class="language-plaintext highlighter-rouge">user2</code> bez roli <code class="language-plaintext highlighter-rouge">user_role</code> (<code class="language-plaintext highlighter-rouge">user2:password2</code>)</li>
</ul>

<h3 id="aplikacja-backendowa">Aplikacja backendowa</h3>

<p>Aplikacja backendowa składa się z dwóch kontrolerów:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">MainController</code> - wystawia zabezpieczone endpointy
    <ul>
      <li><code class="language-plaintext highlighter-rouge">/api/hello</code> - zwraca string <code class="language-plaintext highlighter-rouge">Hello from the Backend!</code></li>
      <li><code class="language-plaintext highlighter-rouge">/api/logout</code> - wylogowuje nas po stronie aplikacji backendowej</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">KeycloakController</code> - wystawia publiczny endpoint
    <ul>
      <li><code class="language-plaintext highlighter-rouge">api/keycloak/config</code> - udostępnia wspólną konfigurację dla frontendu</li>
    </ul>
  </li>
</ul>

<h3 id="aplikacja-frontendowa">Aplikacja frontendowa</h3>

<p>Aplikacja frontendowa składa się z trzech komponentów:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PublicComponent</code> - dostępny dla wszystkich bez logowania</li>
  <li><code class="language-plaintext highlighter-rouge">ProtectedComponent</code> - zabezpieczony przed nieautoryzowanym użytkownikiem</li>
  <li><code class="language-plaintext highlighter-rouge">ToolbarComponent</code> - menu z przyciskami dla wygody</li>
</ul>

<h2 id="uwierzytelnianie-na-backendzie">Uwierzytelnianie na backendzie</h2>

<h3 id="zależności">Zależności</h3>

<p>Na backendzie wykorzystamy zależności:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">org.keycloak:keycloak-adapter-core</code></li>
  <li><code class="language-plaintext highlighter-rouge">org.keycloak:keycloak-spring-boot-2-adapter</code></li>
  <li><code class="language-plaintext highlighter-rouge">org.keycloak:keycloak-tomcat-adapter</code></li>
</ul>

<p>Moglibyśmy wykorzystać jedną zależność, zawierającą powyższe adaptery:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">org.keycloak:keycloak-spring-boot-2-starter</code></li>
</ul>

<p>jednak w najnowszej dostępnej wersji <code class="language-plaintext highlighter-rouge">4.0.0.Final</code> używa starszych wersji adapterów. Jedną ze zmian w nowszych wersjach adapterów, jest poprawiona walidacja tokenów. Jeśli w przyszłości pojawi się nowa wersja zależności, z poprawionymi adapterami, to nic nie będzie stało na przeszkodzie żeby z niej skorzystać.</p>

<h3 id="konfiguracja">Konfiguracja</h3>

<p>Oprócz konfiguracji portu aplikacji oraz poziomu logowania adapterów (dzięki czemu zobaczymy w logach co się dokładnie dzieje), musimy skonfigurować <code class="language-plaintext highlighter-rouge">keycloak-adapter-core</code>.
Dzięki <code class="language-plaintext highlighter-rouge">keycloak-spring-boot-2-adapter</code> możemy wszystko skonfigurować w <code class="language-plaintext highlighter-rouge">application.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">keycloakRequiredUserRole</span><span class="pi">:</span> <span class="s">user_role</span>
<span class="na">keycloak</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">auth-server-url</span><span class="pi">:</span> <span class="s">http://localhost:8180/auth</span>
  <span class="na">realm</span><span class="pi">:</span> <span class="s">SpringBootAngular</span>
  <span class="na">resource</span><span class="pi">:</span> <span class="s">SpringBootAngularClient</span>
  <span class="na">security-constraints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">authRoles</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">${keycloakRequiredUserRole}</span>
      <span class="na">securityCollections</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">protected resource</span>
          <span class="na">patterns</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">/api/*</span>
    <span class="pi">-</span> <span class="na">securityCollections</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">public resource</span>
          <span class="na">patterns</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">/api/keycloak/config</span>
  <span class="na">credentials</span><span class="pi">:</span>
    <span class="na">secret</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;SECRET&gt;"</span>
  <span class="na">realm-key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;PUBLIC_KEY&gt;"</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">keycloakRequiredUserRole</code> - dla ułatwienia, ponieważ wykorzystamy tylko jedną rolę, będzie nam łatwiej udostępnić ją przez api (jeśli chcemy wykorzystać więcej ról, to musimy je wyciągąć z listy <code class="language-plaintext highlighter-rouge">authRoles</code></li>
  <li><code class="language-plaintext highlighter-rouge">keycloak.security-constraints</code> - tutaj definiujemy ograniczenia endpointów</li>
</ul>

<p>Możemy zdefiniować ścieżki dostępne publicznie:
np. <code class="language-plaintext highlighter-rouge">/api/keycloak/config</code>
oraz ścieżki które będą wymagały uprawnień
np. <code class="language-plaintext highlighter-rouge">/api/*</code>
które będzie wymagać od użytkownika roli <code class="language-plaintext highlighter-rouge">${keycloakRequiredUserRole}</code> (czyli <code class="language-plaintext highlighter-rouge">user_role</code>).</p>

<p><strong>Konfiguracja Keycloak:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">keycloak.enabled</code> - umożliwi nam łatwe wyłączenie uwierzytelniania;</li>
  <li><code class="language-plaintext highlighter-rouge">keycloak.auth-server-url</code> - adres serwera Keycloak;</li>
  <li><code class="language-plaintext highlighter-rouge">keycloak.realm</code> - nazwa realmu;</li>
  <li><code class="language-plaintext highlighter-rouge">keycloak.resource</code> - nazwa klienta skonfigurowanego dla podanego realmu;</li>
  <li><code class="language-plaintext highlighter-rouge">keycloak.credentials.secret</code> - secret wygenerowany w <code class="language-plaintext highlighter-rouge">SpringBootAngularClient</code>, możemy go znaleźć w konsoli administracyjnej (<code class="language-plaintext highlighter-rouge">Clients &gt; SpringBootAngularClient &gt; Credentials &gt; Secret</code>);</li>
  <li><code class="language-plaintext highlighter-rouge">keycloak.realm-key</code> - klucz publiczny realmu, możemy go znaleźć w konsoli administracyjnej (<code class="language-plaintext highlighter-rouge">Realm Settings &gt; Keys &gt; Active &gt; RSA &gt; Public Key</code>).</li>
</ul>

<h3 id="wystawienie-konfiguracji-dla-frontendu">Wystawienie konfiguracji dla frontendu</h3>

<p>Ponieważ zabezpieczamy osobno aplikację backendową jak i frontendową, a konfiguracja Keycloak jest taka sama, to możemy wystawić konfigurację z <code class="language-plaintext highlighter-rouge">application.yml</code> przez api. Dzięki temu unikniemy duplikowania konfiguracji w aplikacji frontendowej.</p>

<p>Konfigurację wystawimy w <code class="language-plaintext highlighter-rouge">KeycloakController</code> pod adresem <code class="language-plaintext highlighter-rouge">api/keycloak/config</code>. Będzie ona miała postać:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"authServerUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8180/auth"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"realm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SpringBootAngular"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SpringBootAngularClient"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"requiredUserRole"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_role"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SECRET&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="uwierzytelnianie-na-frontendzie">Uwierzytelnianie na frontendzie</h2>

<h3 id="zależności-1">Zależności</h3>

<p>Po stronie aplikacji frontendowej wykorzystamy bibliotekę <code class="language-plaintext highlighter-rouge">keycloak-angular</code> <a href="https://github.com/mauriciovigolo/keycloak-angular#readme">(link)</a>.</p>

<p>W <code class="language-plaintext highlighter-rouge">package.json</code> dodamy zależności:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"keycloak-angular"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^7.0.1"</span><span class="err">,</span><span class="w">
</span><span class="nl">"keycloak-js"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.0.1"</span><span class="w">
</span></code></pre></div></div>

<h3 id="pobranie-konfiguracji-z-backendu">Pobranie konfiguracji z backendu</h3>

<p>Konfigurację pobierzemy uderzając na endpoint backendu.
Przy pierwszym pobraniu konfiguracji z <code class="language-plaintext highlighter-rouge">KeycloakConfigService</code> zostanie wykonany request, a wynik zostanie zapisany. Kolejne pobrania konfiguracji będą już zwracać zapisaną konfigurację.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span><span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">KeycloakConfigService</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">KeycloakConfig</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">http</span><span class="p">:</span> <span class="nx">HttpClient</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="nx">getConfig</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">KeycloakConfig</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">of</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">configObservable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">KeycloakConfig</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/keycloak/config</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">configObservable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">config</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">configObservable</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="konfiguracja-1">Konfiguracja</h3>

<p>Pobraną konfigurację wykorzystamy w injection tokenie, definiując w <code class="language-plaintext highlighter-rouge">app.module.ts</code> provider dla tokenu <a href="https://angular.io/api/core/APP_INITIALIZER"><code class="language-plaintext highlighter-rouge">APP_INITIALIZER</code></a>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="nl">provide</span><span class="p">:</span> <span class="nx">APP_INITIALIZER</span><span class="p">,</span>
    <span class="nx">useFactory</span><span class="p">:</span> <span class="nx">initializer</span><span class="p">,</span>
    <span class="nx">multi</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">deps</span><span class="p">:</span> <span class="p">[</span><span class="nx">KeycloakService</span><span class="p">,</span> <span class="nx">KeycloakConfigService</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jako <code class="language-plaintext highlighter-rouge">initializer</code> utworzymy funkcję wykorzystującą nasz <code class="language-plaintext highlighter-rouge">KeycloakConfigService</code> oraz inicjalizującą <code class="language-plaintext highlighter-rouge">KeycloakService</code> z biblioteki <code class="language-plaintext highlighter-rouge">keycloak-angular</code>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">initializer</span><span class="p">(</span><span class="nx">keycloakService</span><span class="p">:</span> <span class="nx">KeycloakService</span><span class="p">,</span> <span class="nx">keycloakConfigService</span><span class="p">:</span> <span class="nx">KeycloakConfigService</span><span class="p">):</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="nx">keycloakConfigService</span><span class="p">.</span><span class="nx">getConfig</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
            <span class="nx">filter</span><span class="p">(</span><span class="nx">config</span> <span class="o">=&gt;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">enabled</span><span class="p">),</span>
            <span class="nx">flatMap</span><span class="p">(</span><span class="nx">config</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">keycloakService</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
                    <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
                        <span class="na">url</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">authServerUrl</span><span class="p">,</span>
                        <span class="na">realm</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">realm</span><span class="p">,</span>
                        <span class="na">clientId</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">resource</span><span class="p">,</span>
                        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
                            <span class="na">secret</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">secret</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="na">initOptions</span><span class="p">:</span> <span class="p">{</span>
                        <span class="na">onLoad</span><span class="p">:</span> <span class="dl">'</span><span class="s1">check-sso</span><span class="dl">'</span><span class="p">,</span>
                        <span class="na">checkLoginIframe</span><span class="p">:</span> <span class="kc">false</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">})).</span><span class="nx">toPromise</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="zabezpieczenie-routeów">Zabezpieczenie route’ów</h3>

<p>Aby zabezpieczyć routy, wykorzystamy <a href="https://angular.io/guide/router#guards"><code class="language-plaintext highlighter-rouge">Angular Route Guard</code></a>.
Stworzymy <code class="language-plaintext highlighter-rouge">AppAuthGuard</code> rozszerzając <code class="language-plaintext highlighter-rouge">KeycloakAuthGuard</code> oraz implementując <a href="https://angular.io/api/router/CanActivate">canActivate</a>.</p>

<p>W konstruktorze pobierzemy konfigurację z <code class="language-plaintext highlighter-rouge">KeycloakConfigService</code>, aby zweryfikować czy uwierzytelnianie jest włączone (parametr <code class="language-plaintext highlighter-rouge">keycloak.enabled</code> w <code class="language-plaintext highlighter-rouge">application.yml</code>), oraz czy użytkownik posiada wymaganą rolę:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
    <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppAuthGuard</span> <span class="kd">extends</span> <span class="nx">KeycloakAuthGuard</span> <span class="p">{</span>
    <span class="nl">isAuthEnabled</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nl">requiredUserRole</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">protected</span> <span class="nx">router</span><span class="p">:</span> <span class="nx">Router</span><span class="p">,</span> <span class="k">protected</span> <span class="nx">keycloakService</span><span class="p">:</span> <span class="nx">KeycloakService</span><span class="p">,</span> <span class="k">private</span> <span class="nx">keycloakConfigService</span><span class="p">:</span> <span class="nx">KeycloakConfigService</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">router</span><span class="p">,</span> <span class="nx">keycloakService</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">keycloakConfigService</span><span class="p">.</span><span class="nx">getConfig</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">config</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isAuthEnabled</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">enabled</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">requiredUserRole</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">requiredUserRole</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">canActivate</span><span class="p">(</span><span class="nx">route</span><span class="p">:</span> <span class="nx">ActivatedRouteSnapshot</span><span class="p">,</span> <span class="nx">state</span><span class="p">:</span> <span class="nx">RouterStateSnapshot</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isAuthEnabled</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nx">canActivate</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="k">as</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">isAccessAllowed</span><span class="p">(</span><span class="nx">route</span><span class="p">:</span> <span class="nx">ActivatedRouteSnapshot</span><span class="p">,</span> <span class="nx">state</span><span class="p">:</span> <span class="nx">RouterStateSnapshot</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">keycloakService</span><span class="p">.</span><span class="nx">login</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">roles</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">requiredUserRole</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>a następnie wykorzystamy naszego guarda w <code class="language-plaintext highlighter-rouge">app-routing.module.ts</code> do zabezpieczenia routa <code class="language-plaintext highlighter-rouge">protected</code>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">routes</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">component</span><span class="p">:</span> <span class="nx">PublicComponent</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">protected</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">component</span><span class="p">:</span> <span class="nx">ProtectedComponent</span><span class="p">,</span>
        <span class="na">canActivate</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppAuthGuard</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">];</span>
</code></pre></div></div>

<h2 id="testy">Testy</h2>

<h3 id="uruchomienie">Uruchomienie</h3>

<p>Jeśli mamy już uruchomiony serwer Keycloak, możemy zbudować aplikacje i obraz dockerowy, a następnie uruchomić kontener.</p>

<p>W tym celu w głównym folderze repozytorium najpierw budujemy aplikacje:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gradlew build
</code></pre></div></div>

<p>po zbudowaniu tworzymy obraz dockerowy:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> michuu93/spring-angular-keycloak-demo <span class="nb">.</span>
</code></pre></div></div>

<p>a na koniec uruchamiamy kontener:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--name</span> spring-angular-keycloak-demo <span class="nt">--network</span> host michuu93/spring-angular-keycloak-demo
</code></pre></div></div>

<p>Ponieważ zarówno aplikacje z wnętrza kontenera, jak i my z przeglądarki internetowej musimy mieć dostęp do serwera Keycloak pod tym samym adresem, nie wnikając w zasadę działania sieci w dockerze uruchomiliśmy kontener z opcją <code class="language-plaintext highlighter-rouge">--network host</code>.</p>

<p>Dzięki temu nie musimy wystawiać dodatkowo żadnego proxy ani podmieniać hostów w naszym systemie. Jest to jednak ułatwienie na potrzeby demo i nie powinniśmy go wykorzystywać na produkcji.</p>

<h3 id="weryfikacja-działania-uwierzytelniania">Weryfikacja działania uwierzytelniania</h3>

<p>Po uruchomieniu możemy sprawdzić aplikacje w działaniu!</p>

<p>Przechodzimy na stronę <a href="http://localhost:9082/">localhost:9082</a> i powinniśmy zobaczyć aplikację frontendową, a dokładniej <code class="language-plaintext highlighter-rouge">ToolbarComponent</code> oraz <code class="language-plaintext highlighter-rouge">PublicComponent</code>:</p>

<p><img src="/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/public_component_not_logged.png" alt="Public component" /></p>

<p>Do dyspozycji mamy menu, z którego możemy przejść do:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Public</code> - niezabezpieczonego route z <code class="language-plaintext highlighter-rouge">PublicComponent</code>;</li>
  <li><code class="language-plaintext highlighter-rouge">Protected</code> - zabezpieczonego route z <code class="language-plaintext highlighter-rouge">ProtectedComponent</code>;</li>
  <li><code class="language-plaintext highlighter-rouge">Keycloak Configuration</code> - niezabezpieczonego endpointu udostępniającego konfiguację Keycloak z backendu;</li>
  <li><code class="language-plaintext highlighter-rouge">Backend Hello</code> - zabezpieczonego endpointu zwracającego tekst <code class="language-plaintext highlighter-rouge">Hello from the Backend!</code>;</li>
  <li><code class="language-plaintext highlighter-rouge">Logout (backend)</code> - wylogowania z backendu;</li>
  <li><code class="language-plaintext highlighter-rouge">Logout (frontend)</code> - przycisk widoczny tylko po zalogowaniu na frontendzie, który wylogowuje nas z frontendu.</li>
</ul>

<p>Sprawdźmy więc czy mamy dostęp do <code class="language-plaintext highlighter-rouge">Keycloak Configuration</code> bez zalogowania:
<img src="/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/keycloak_config.png" alt="Keycloak Configuration" /></p>

<p>Wygląda na to, że publicznie dostępny route i endpoint api, działają poprawnie.</p>

<p>Jeśli teraz przejdziemy do <code class="language-plaintext highlighter-rouge">Protected</code>, zostaniemy przekierowani na stronę logowania Keycloak:</p>

<p>http://localhost:8180/auth/realms/<strong>SpringBootAngular</strong>/protocol/<strong>openid-connect</strong>/auth?client_id=<strong>SpringBootAngularClient</strong>&amp;redirect_uri=<strong>http%3A%2F%2Flocalhost%3A9082%2F%23%2F</strong>&amp;state=3e007783-4772-48dd-8b31-4bfe3cc9c42c&amp;response_mode=fragment&amp;response_type=code&amp;scope=openid&amp;nonce=023ab545-32dc-4bdc-9cbf-12cad1d0c944</p>

<p><img src="/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/keycloak_login.png" alt="Keycloak login" /></p>

<p>Jak widzimy, adres zawiera informacje, takie jak nazwa protokołu, realm, client czy adres, na który mamy zostać przekierowani po zalogowaniu.</p>

<p>Jeśli zalogujemy się użytkownikiem posiadającym rolę <code class="language-plaintext highlighter-rouge">user_role</code> (<code class="language-plaintext highlighter-rouge">user:password</code>), to zostaniemy przekierowani z powrotem do naszej aplikacji:</p>

<p><img src="/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/public_component_logged.png" alt="Public component" /></p>

<p>Dodatkowo mamy jeszcze tylko przycisk <code class="language-plaintext highlighter-rouge">Logout (frontend)</code>. Jesteśmy teraz zalogowani, więc możemy przejść do <code class="language-plaintext highlighter-rouge">Protected</code>:</p>

<p><img src="/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/protected_component.png" alt="Protected component" /></p>

<p>Zadziała również <code class="language-plaintext highlighter-rouge">Backend Hello</code>:</p>

<p><img src="/assets/img/posts/2020-02-01-keycloak-uwierzytelnianie-autoryzacja-springboot-angular/backend_hello.png" alt="Backend Hello" /></p>

<p>Jeśli wylogujemy się teraz z frontendu - <code class="language-plaintext highlighter-rouge">Logout (frontend)</code>, to zniknie przycisk <code class="language-plaintext highlighter-rouge">Logout (frontend)</code> i nie będziemy mieli już dostępu do <code class="language-plaintext highlighter-rouge">Protected</code>.
Cały czas jednak będziemy mieli dostęp do <code class="language-plaintext highlighter-rouge">Backend Hello</code>. Dopiero kiedy wylogujemy się z backendu - <code class="language-plaintext highlighter-rouge">Logout (backend)</code>, to stracimy dostęp do <code class="language-plaintext highlighter-rouge">Backend Hello</code>.
Jednak jeśli będąc zalogowanym użytkownikiem, wylogujemy się z backendu a nie frontendu, to automatycznie zostaniemy również wylogowani z frontendu.</p>

<p>Dlaczego?</p>

<p>O tym jak działa Keycloak i tokeny, którymi się posługujemy (a dokładniej standard OpenID Connect) nie jest tematem tego wpisu. Co do kwestii wylogowywania, to temat (ze względu na złożoność implementacji) nadaje się na osobny wpis, szczególnie gdy mówimy o rozproszonych systemach z wieloma instancjami aplikacji, stojącymi za loadbalancerem.</p>

<p>Projekt demo posiada bardzo prosty mechanizm wylogowywania.</p>

<p>Wylogowanie z frontendu wywoła metodę <code class="language-plaintext highlighter-rouge">logout</code> na serwisie biblioteki <code class="language-plaintext highlighter-rouge">keycloak-angular</code>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">logout</span> <span class="o">=</span> <span class="k">async</span> <span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">keycloakService</span><span class="p">.</span><span class="nx">logout</span><span class="p">();</span>
</code></pre></div></div>

<p>Natomiast wylogowanie z backendu uderzy na <code class="language-plaintext highlighter-rouge">/api/logout</code>, co spowoduje wykonanie na backendzie:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fun</span> <span class="nf">logout</span><span class="o">(</span><span class="nl">request:</span> <span class="nc">HttpServletRequest</span><span class="o">,</span> <span class="nl">response:</span> <span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">request</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Na koniec sprawdźmy jeszcze użytkownika bez roli <code class="language-plaintext highlighter-rouge">user_role</code> (<code class="language-plaintext highlighter-rouge">user2:password2</code>).</p>

<p>Po zalogowaniu, w aplikacji powinniśmy zobaczyć te same przyciski w menu, co na użytkowniku posiadającym wymaganą rolę.
Jest tak, ponieważ ukrywanie przycisków uzależniliśmy tylko od tego, czy użytkownik jest zalogowany, a nie czy ma uprawnienia do routa:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ngOnInit</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">keycloakService</span><span class="p">.</span><span class="nx">isLoggedIn</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">isLogged</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">isLogged</span> <span class="o">=</span> <span class="nx">isLogged</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Uderzenie na <code class="language-plaintext highlighter-rouge">Backend Hello</code> również nie zadziała.</p>

<p>Uwierzytelnianie możemy bardzo szybko wyłączyć w obu aplikacjach, ustawiając <code class="language-plaintext highlighter-rouge">keycloak.enabled</code> w <code class="language-plaintext highlighter-rouge">application.yml</code> na <code class="language-plaintext highlighter-rouge">false</code>.
Może być to przydatne np. na środowiskach testowych.</p>

<h2 id="na-zakończenie">Na zakończenie</h2>

<p>Mam nadzieję, że udało mi się w przystępny sposób przedstawić integrację aplikacji z serwerem Keycloak.</p>

<p>Nie jest to jedyny sposób implementacji, jeśli nasza aplikacja ma być bardziej elastyczna, możemy wykorzystać implementację standardu OAuth2 przy użyciu <code class="language-plaintext highlighter-rouge">Spring Security</code>. Dzięki temu nie uzależnimy się od serwera Keycloak i w przyszłości będziemy mogli łatwiej zamienić go na inny serwer uwierzytelniania/autoryzacji.</p>

<p>Keycloak wystawia endpointy pod którymi udostępnia konfigurację <a href="https://www.keycloak.org/docs/4.8/server_admin/#keycloak-server-oidc-uri-endpoints">(link)</a>.
Znajdziemy je w <code class="language-plaintext highlighter-rouge">Realm Settings &gt; General &gt; Endpoints</code>, np. dla standardu OpenID Connect będzie to w naszym przypadku:
<a href="http://127.0.0.1:8180/auth/realms/SpringBootAngular/.well-known/openid-configuration">http://127.0.0.1:8180/auth/realms/SpringBootAngular/.well-known/openid-configuration</a>
Mogą być one przydatne, jeśli aplikacja nie wykorzystuje adapterów Keycloak do połączenia z serwerem.</p>

<p>Nie musimy też wykorzystywać logowania do aplikacji przez przeglądarkę - możemy wykorzystać Keycloaka do uwierzytelniania aplikacji między sobą, np. kiedy integrujemy ze sobą różne moduły. Wtedy przydatna będzie opcja <code class="language-plaintext highlighter-rouge">bearer-only</code> w konfiguracji clienta.</p>

                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-desktop">
                
<div class="sidebar-container latest-posts">
    <div class="sidebar-title">
        Newest posts
    </div>
    <hr class="latest-posts-separator">
    <div class="sidebar-latest-posts-container">
        <ul class="sidebar-posts"><li class="sidebar-post no-breaking-word star-icon">
                <a href="/en/2021/09/13/kafka-retry-dlq.html" lang="pl">Reliable event delivery in Apache Kafka based on retry and DLQ</a>
            </li><li class="sidebar-post no-breaking-word star-icon">
                <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html" lang="pl">Event Tracking - finding a needle in a haystack</a>
            </li><li class="sidebar-post no-breaking-word star-icon">
                <a href="/en/2021/08/30/kouncil-introduction.html" lang="pl">Kouncil - a modern Kafka frontend</a>
            </li></ul>
    </div>
</div>

                <div class="sidebar-container offers" id="offers-sidebar">
    <div class="sidebar-title offers-title">
        Join us
    </div>
    <hr class="offers-separator">
    <ul class="sidebar-posts offers-list">
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/senior-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">SENIOR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 14 900 - 20 590 PLN brutto <br/>
                            B2B 19 680 - 27 220 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/regular-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">REGULAR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 11 300 - 15 900 PLN brutto <br/>
                            B2B 14 950 - 21 000 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a class="clickable-offer" href="https://www.consdata.com/pl/kariera/trwajace-rekrutacje#tag-developer">
                <div class="other-job-offers">
                    <span class="job-title">ZOBACZ WSZYSTKIE OGŁOSZENIA</span>
                </div>
            </a>
        </li>
    </ul>
</div>

                
<div class="sidebar-container newsletter-sidebar-tile">
    <div class="newsletter-tile-title-container">
        
        <h2 class="newsletter-tile-title">technical</h2>
        <h2 class="newsletter-tile-title">newsletter</h2>
    
    </div>
    <a href="#newsletter-form" class="sign-up-btn">Sign up</a>
</div>

            </div>
        </div>
        <div class="recommended-container" id="recommended-posts-container">
    <h2 class="title">
        Podobne wpisy
    </h2>
    <div id="latest-posts-container" class="latest-posts-container">



<div class="post-tile">
    <a class="small-post-image" href="/en/2021/09/13/kafka-retry-dlq.html">
        <img class="tile-image small-post-image" src="/assets/img/posts/2021-09-13-kafka-retry-dlq/thumbnail.webp" alt="post-image"/>
    </a>
    <div class="post-tile-content">
        <div class="badge-panel">
            <div class="badge">kouncil</div>
        </div>
        <h4 class="post-title no-breaking-word">
            <a href="/en/2021/09/13/kafka-retry-dlq.html">Reliable event delivery in Apache Kafka based on retry and DLQ</a>
        </h4>

        <p class="post-description no-breaking-word">
            <a href="/en/2021/09/13/kafka-retry-dlq.html">
                
                Why is there no DLQ in Kafka? Most popular queueing systems such as RabbitMQ or ActiveMQ have built-in systems responsible for reliable message delivery. So why doesn't Kafka offer one?...
                
            </a>
        </p>

        <div class="tile-author"><a href="/en/authors/jgrobelny.html" class="author-name author-img">
                <img class="small-author-image" src="/assets/img/authors/jgrobelny.webp" alt="author">
            </a>
            <div class="post-info">
                <a href="/en/authors/jgrobelny.html" class="author-name">Jacek Grobelny</a>
                <span class="post-date">
13


Sep


2021
</span>
            </div></div>
    </div>
</div>




<div class="post-tile">
    <a class="small-post-image" href="/en/2021/09/08/kouncil-event-tracking-kafka.html">
        <img class="tile-image small-post-image" src="/assets/img/posts/2021-09-08-kouncil-event-tracking-kafka/thumbnail.webp" alt="post-image"/>
    </a>
    <div class="post-tile-content">
        <div class="badge-panel">
            <div class="badge">kouncil</div>
        </div>
        <h4 class="post-title no-breaking-word">
            <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html">Event Tracking - finding a needle in a haystack</a>
        </h4>

        <p class="post-description no-breaking-word">
            <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html">
                
                Event tracking allows for tracking and visualising the path of a given event or process through Kafka topics.
                
            </a>
        </p>

        <div class="tile-author"><a href="/en/authors/mmergo.html" class="author-name author-img">
                <img class="small-author-image" src="/assets/img/authors/mmergo.webp" alt="author">
            </a>
            <div class="post-info">
                <a href="/en/authors/mmergo.html" class="author-name">Marcin Mergo</a>
                <span class="post-date">
8


Sep


2021
</span>
            </div></div>
    </div>
</div>




<div class="post-tile">
    <a class="small-post-image" href="/en/2021/08/30/kouncil-introduction.html">
        <img class="tile-image small-post-image" src="/assets/img/posts/2021-08-30-kouncil-introduction/thumbnail.webp" alt="post-image"/>
    </a>
    <div class="post-tile-content">
        <div class="badge-panel">
            <div class="badge">kouncil</div>
        </div>
        <h4 class="post-title no-breaking-word">
            <a href="/en/2021/08/30/kouncil-introduction.html">Kouncil - a modern Kafka frontend</a>
        </h4>

        <p class="post-description no-breaking-word">
            <a href="/en/2021/08/30/kouncil-introduction.html">
                
                Kouncil is a modern Kafka frontend equipped with features essential for developers.
                
            </a>
        </p>

        <div class="tile-author"><a href="/en/authors/jgrobelny.html" class="author-name author-img">
                <img class="small-author-image" src="/assets/img/authors/jgrobelny.webp" alt="author">
            </a>
            <div class="post-info">
                <a href="/en/authors/jgrobelny.html" class="author-name">Jacek Grobelny</a>
                <span class="post-date">
30


Aug


2021
</span>
            </div></div>
    </div>
</div>
</div>
    <img id="arrow-icon" onclick="toggleRecommendation()" class="arrow rotated" src="/assets/icon/arrow.svg">
</div>

<script>

    let expended = false;
    const arrowIcon = document.getElementById("arrow-icon")

    function toggleRecommendation() {
        if (expended) {
            document.getElementById("latest-posts-container").classList.remove("hide");
            arrowIcon.classList.add("rotated");
        } else {
            document.getElementById("latest-posts-container").classList.add("hide");
            arrowIcon.classList.remove("rotated");
        }
        
        expended = !expended;
    }

</script>

        <div class="consdata-offers-mobile">
            <div class="sidebar-container offers" id="offers-sidebar">
    <div class="sidebar-title offers-title">
        Join us
    </div>
    <hr class="offers-separator">
    <ul class="sidebar-posts offers-list">
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/senior-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">SENIOR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 14 900 - 20 590 PLN brutto <br/>
                            B2B 19 680 - 27 220 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/regular-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">REGULAR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 11 300 - 15 900 PLN brutto <br/>
                            B2B 14 950 - 21 000 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a class="clickable-offer" href="https://www.consdata.com/pl/kariera/trwajace-rekrutacje#tag-developer">
                <div class="other-job-offers">
                    <span class="job-title">ZOBACZ WSZYSTKIE OGŁOSZENIA</span>
                </div>
            </a>
        </li>
    </ul>
</div>

        </div>
        <div class="newsletter-sub-container" id="newsletter-sub-container">
    <div class="title">
        
        <h2>Sign up for a </h2>
        <h2>technical </h2>
        <h2 class="newsletter">newsletter</h2>
        
    </div>
    <div id="newsletter-form" class="newsletter-agreement-form-content">
        <form class="newsletter-form" action="https://app2.salesmanago.pl/form/e7yrrpjmxbm7bahc/contact.htm" method="post" target="_blank" onsubmit="">
            <input type="hidden" name="lang" value="pl">
            <input type="hidden" name="formId" value="fe234ba7-932a-438e-aca0-0cf324930910">
            <input type="hidden" value="true" name="sm-form-consent-id-2634-NEWSLETTER_JAVA">
            <div class="form-inputs">
                <input required placeholder="Name *" name="sm-form-name"/>
                <input required type="email" placeholder="E-mail" name="sm-form-email"/>
            </div>
            <div class="form-checkbox-container">
                <label class="form-checkbox">
                    <input required type="checkbox" name="sm-form-consent-name-NEWSLETTER_JAVA"/>
                    <div class="form-checkbox-input"></div>
                    <span>By submitting the form, you consent to the processing of your data in accordance with the Privacy Policy*.</span>
                </label>
            </div>
            <button class="sign-up-btn">Sign up</button>
        </form>
    </div>
</div>

    </article>
</div>
<script>
    const language = 'en';
    const jsonPath = language === 'en' ? '/en/json/posts.json' : '/json/posts.json';
    fetch(jsonPath)
        .then(response => response.json())
        .then(store => {
            function displayResults(results) {
                if (results.length > 0) {
                    const container = document.getElementById("recommended-posts");
                    results
                        .forEach(result => {
                            const item = store[result.ref];
                            if (item.lang === language) {
                                const listElement = document.createElement('li');
                                const anchor = document.createElement('a');
                                const postTitle = document.createTextNode(item.title);
                                listElement.classList.add('sidebar-post');
                                listElement.classList.add('no-breaking-word');
                                anchor.setAttribute('href', item.url);
                                anchor.setAttribute('lang', 'pl');
                                anchor.appendChild(postTitle);
                                listElement.appendChild(anchor);
                                container.appendChild(listElement);
                            }
                        });
                    if (container.children.length < 1) {
                        hideRecommendedPosts();
                    }
                } else {
                    hideRecommendedPosts();
                }

            }

            const tags = "angular spring boot keycloak keycloak-spring-boot-2-starter keycloak-spring-boot-2-adapter keycloak-angular uwierzytelnianie użytkownika";
            const idx = lunr(function () {
                this.field('tags');

                for (let key in store) {
                    this.add({
                        'id': key,
                        'title': store[key].title,
                        'tags': store[key].tags,
                    });
                }
            });
            const results = idx.search(tags).slice(1, 4);
            displayResults(results);
        })

    function hideRecommendedPosts() {
        document.getElementById("recommended-posts-container").style.display = 'none';
    }
</script>

</main><footer>
    <div class="container">
        <a class="footer-logo" href="https://consdata.com/pl">
            <img src="/assets/img/logo.png" alt="consdata.com">
        </a>
        <div class="footer-content">
            <div class="footer-menu">
                <ul class="menu">
                    <li class="menu-item">
                        <p class="menu-title">Contact</p>
                        <ul class="submenu">
                            <li>
                                <a href="mailto:sales@consdata.com">sales@consdata.com</a>
                            </li>
                            <li>
                                <p>+48 61 41 51 000</p>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <p class="menu-title">Office</p>
                        <ul class="submenu">
                            <li>
                                <p>K9Office<br>Krysiewicza 9/14<br>61-825 Poznań<br>Polska</p>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <p class="menu-title">Solutions</p>
                        <ul class="submenu">
                            <li>
                                <a href="https://eximee.com" target="_blank">Eximee</a>
                            </li>
                            <li>
                                <a href="https://kouncil.io" target="_blank">Kouncil</a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="/en/" class="menu-title">Blog</a>
                        <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje" class="menu-title"
                           target="_blank">Join us</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="small-footer-container">
        <div class="footer-copyright">
            <span>Copyright © 2024 Consdata. All rights reserved.</span>
            <span>
                <a href="https://consdata.com/pl/polityka-prywatnosci"
                     class="privacy-policy">Privacy Policy & Cookies</a>
            </span>
        </div>
        <div class="social-footer">
            <a target="_blank" href="https://www.facebook.com/consdatacom">
                <img class="icon" src="/assets/icon/social-f.svg">
            </a>
            <a target="_blank" href="https://www.linkedin.com/company/consdata">
                <img class="icon" src="/assets/icon/social-in.svg">
            </a>
            <a target="_blank" href="https://github.com/Consdata">
                <img class="icon" src="/assets/icon/github.svg">
            </a>
            <a target="_blank" href="https://forum.eximee.com/">
                <img class="icon" src="/assets/icon/social-icon.svg">
            </a>
        </div>
    </div>
</footer>
<div class="cookie-notice" id="cookie-notice">
    <i onclick="hideConsent()" class="close-consent fa fa-times close"></i>
    <div class="cookie-container">
        <span>
            
            Chcemy używać plików cookie oraz skryptów podmiotów trzecich do polepszania funkcjonowania tej strony
        </span>
        <a id="cookie-notice-accept" class="consent-button">Zgadzam się</a>
    </div>
        <noscript><img height="1" width="1" style="display:none"
                   src="https://www.facebook.com/tr?id=300808861525851&ev=PageView&noscript=1"
    /></noscript>
</div>

<script>
    function createCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    function readCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function eraseCookie(name) {
        createCookie(name, "", -1);
    }

    function hideConsent() {
        document.getElementById('cookie-notice').style.display = 'none';
    }

    if (readCookie('cookie-notice-dismissed') === 'true') {!function (f, b, e, v, n, t, s) {
    if (f.fbq) return;
    n = f.fbq = function () {
        n.callMethod ?
            n.callMethod.apply(n, arguments) : n.queue.push(arguments)
    };
    if (!f._fbq) f._fbq = n;
    n.push = n;
    n.loaded = !0;
    n.version = '2.0';
    n.queue = [];
    t = b.createElement(e);
    t.async = !0;
    t.src = v;
    s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s)
}(window, document, 'script',
    'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '300808861525851');
fbq('track', 'PageView');
} else {
        document.getElementById('cookie-notice').style.display = 'flex';
    }

    document.getElementById('cookie-notice-accept').addEventListener("click", function () {
        createCookie('cookie-notice-dismissed', 'true', 31);
        hideConsent();
        location.reload();
    });
</script>

</body>
</html>
