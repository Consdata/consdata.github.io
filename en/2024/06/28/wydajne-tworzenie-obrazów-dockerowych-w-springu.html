<!DOCTYPE html>
<html lang="en">
<script src="/js/lunr.min.js"></script><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Wydajne tworzenie obrazów dockerowych w Springu | Consdata - blog techniczny</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Wydajne tworzenie obrazów dockerowych w Springu" />
<meta name="author" content="bpietrowiak" />
<meta property="og:locale" content="pl" />
<meta name="description" content="Sprawdź jak zaoszczędzić miejsce budując kolejne wersje aplikacji." />
<meta property="og:description" content="Sprawdź jak zaoszczędzić miejsce budując kolejne wersje aplikacji." />
<link rel="canonical" href="https://blog.consdata.tech/en/2024/06/28/wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu.html" />
<meta property="og:url" content="https://blog.consdata.tech/2024/06/28/wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu.html" />
<meta property="og:site_name" content="Consdata - blog techniczny" />
<meta property="og:image" content="https://blog.consdata.tech/assets/img/posts/2024-06-28-wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu/docker.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-28T02:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.consdata.tech/assets/img/posts/2024-06-28-wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu/docker.webp" />
<meta property="twitter:title" content="Wydajne tworzenie obrazów dockerowych w Springu" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"bpietrowiak"},"image":"https://blog.consdata.tech/assets/img/posts/2024-06-28-wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu/docker.webp","@type":"BlogPosting","headline":"Wydajne tworzenie obrazów dockerowych w Springu","description":"Sprawdź jak zaoszczędzić miejsce budując kolejne wersje aplikacji.","dateModified":"2024-06-28T02:00:00-05:00","datePublished":"2024-06-28T02:00:00-05:00","url":"https://blog.consdata.tech/2024/06/28/wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.consdata.tech/2024/06/28/wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,700,600,500,300,200,100,800,900" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,600,500,300,200,100,800,900" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;400;500;700&display=swap" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.consdata.tech/en/feed.xml" title="Consdata - blog techniczny" /><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NFV6DPR');</script>


  <link rel="icon" type="image/x-icon" href="/en/favicon.ico">
</head>
<body><nav class="site-header">
    <div class="container">
        <div class="header navbar-default" role="navigation">
            <div class="header-brand">
                <a class="header-logo" href="/en/">
                    <img src="/assets/img/logo.png" alt="consdata.com">
                </a>
                <div class="mobile-search">
                    
<form action="/en/search.html" method="get">

    <div class="search-input-container">
        <input type="text" placeholder="Find an article..." id="search-box-mobile" name="query" class="search-input" autocomplete="off">
        <i class="fa fa-search search-icon" onclick="expandInputMobile()"></i>
    </div>
</form>

<script>
    const inputMobile = document.getElementById("search-box-mobile");
    const logo = document.getElementById("header-logo");
    const expandInputMobile = () => {
        inputMobile.classList.toggle("expanded");
        logo.classList.toggle("header-logo");
        logo.classList.toggle("logo-invisible");
    };
</script>

                </div>
            </div>
            <div id="header-links">
                <div>
                    <a class="nav-link" href="/en/">Technical blog</a>
                    <a class="nav-link" href="https://consdata.com/pl/blog/biznesowy">Business blog</a>
                    <a class="nav-link" href="https://consdata.com/pl/blog/hr">HR department</a>
                </div>
                
                <a class="language-switch" onclick="navigate(' /2024/06/28/wydajne-tworzenie-obraz%C3%B3w-dockerowych-w-springu.html')">PL</a>
                
            </div>

        </div>
    </div>
</nav>
<script>
    function navigate(baseUrl) {
        const queryParams = window.location.search;
        window.location.href = baseUrl + queryParams;
    }
</script>
<main class="page-content" aria-label="Content">
    


<div class="blog">
    <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="post-content-sidebar">
            <div class="post-content">
                <div class="badge">spring boot</div>
                <h1 class="post-big-title p-name" itemprop="name headline">Wydajne tworzenie obrazów dockerowych w Springu</h1>
                <div class="post-metadata">
    <div>
    <a class="author" href="/en/authors/bpietrowiak.html">
        <img class="author-image" src="/assets/img/authors/bpietrowiak.jpg" alt="author">
        <span class="author-name">Bartosz Pietrowiak</span><a class="author" href="https://github.com/BartoszPietrowiak">
            <img class="github-icon" src="/assets/icon/github.svg">
        </a>
        
    </a>
</div>

    <div class="metadata">
        
        <span class="publish-date">
28


June


2024
</span>
    </div>
</div>

                <div itemprop="articleBody" class="post-content-container">
                    <div class="post-content-left-pane">
                        <div class="post-content">
                            <h2 id="jak-działa-budowanie-obrazów-dockerowych">Jak działa budowanie obrazów dockerowych?</h2>
<p>Budowanie obrazów dockerowych polega na tworzeniu niemodyfikowalnych “szablonów” aplikacji i zależności, które mogą być uruchamiane w izolowanych kontenerach. Proces ten jest zautomatyzowany za pomocą plików o nazwie Dockerfile.</p>

<p>Każdy plik Dockerfile zawiera listę instrukcji wykonywanych w podanej kolejności w momencie budowania obrazu. Docker konwertuje otrzymaną listę instrukcji na warstwy, które składają się na budowany obraz i mają określony rozmiar w przestrzeni dyskowej.</p>

<p><img src="/assets/img/posts/2024-06-28-wydajne-tworzenie-obrazów-dockerowych-w-springu/builder.png" alt="Schemat budowania obrazu" /></p>

<p>Podczas uruchomienia budowania builder podejmuję próbę ponownego wykorzystania warstw z poprzednich wersji. Jeśli warstwa obrazu jest niezmieniona, builder wyciąga ją z cache. Jeśli warstwa uległa zmianie, tworzy ją na nowo.
Ponowne tworzenie warstwy wiążę się również z unieważnieniem cache dla wszystkich następnych warstw. Jeśli plik .jar ulegnie zmianie, to schemat warstw przedstawia się następująco:</p>

<p><img src="/assets/img/posts/2024-06-28-wydajne-tworzenie-obrazów-dockerowych-w-springu/cache.png" alt="Schemat budowania obrazu z cache" /></p>

<p>Aby z cache była pobierana jak największa liczba warstw, bardzo ważna jest kolejność deklarowania instrukcji. Dla powyższego przykładu możemy wykonać optymalizację:
<img src="/assets/img/posts/2024-06-28-wydajne-tworzenie-obrazów-dockerowych-w-springu/cache2.png" alt="Schemat budowania obrazu z cache optymalizacja" /></p>

<p>Dzięki temu, przy następnym budowaniu, builder ponownie wykorzysta trzy, a nie tylko dwie warstwy.</p>

<h2 id="klasyczne-podejście-do-budowania">Klasyczne podejście do budowania</h2>

<p>W poprzedniej sekcji pokazaliśmy standardowy plik Dockerfile do zbudowania aplikacji Spring Bootowej. Plik ten zawiera między innymi instrukcję przekopiowania pliku .jar do obrazu. Standardowo wykonuje się to za pomocą jednej instrukcji, co oznacza, że jakakolwiek zmiana w którymkolwiek pliku aplikacji powoduje konieczność utworzenia warstwy od nowa.
Jest to bardzo niekorzystne, ponieważ wiąże się z wykorzystaniem nadmiernej przestrzeni dyskowej. Przyjmując, że plik .jar waży około 20 MB (większość z tego to zależności aplikacji), to 10 wersji aplikacji zajmie 200 MB, pomimo że zmiany, są niewielkie i dotyczą tylko kodów źródłowych, ważących przeciętnie kilkanaście KB.</p>

<p>Tutaj naprzeciw wyszli nam twórcy Spring Boota, dodając od wersji 2.3 możliwość budowania warstwowego pliku jar (eng. <strong>layered jars</strong>).</p>

<h2 id="jak-działa-spring-boot-layered-jar">Jak działa Spring Boot layered jar?</h2>
<p>Spring Boot layered jar zmienia sposób budowania pliku .jar, dzieląc jego części na konkretne warstwy. Wykorzystuje do tego plik <code class="language-plaintext highlighter-rouge">layers.idx</code>, który zawiera listę warstw oraz części pliku .jar zawarte w każdej z nich. Warstwy w pliku zapisane są w kolejności, w jakiej powinny zostać dodane do obrazu dockerowego. Domyślnie plik składa się z poniższych warstw:</p>
<ul>
  <li><strong>dependencies</strong> - zawiera wszystkie zależności aplikacji, które nie są w wersji SNAPSHOT</li>
  <li><strong>spring-boot-loader</strong> - zawiera klasy ładujące plik .jar (odpowiadające za uruchomienie aplikacji)</li>
  <li><strong>snapshot-dependencies</strong> - zawiera zależności aplikacji w wersji SNAPSHOT</li>
  <li><strong>application</strong> - zawiera kod źródłowy aplikacji</li>
</ul>

<p>Dzięki takiemu rozwiązaniu jesteśmy w stanie podzielić instrukcję kopiowania pliku .jar na kilka mniejszych instrukcji i zapewnić ponowne wykorzystanie warstw, gdy zmienimy tylko kod źródłowy aplikacji.</p>

<h2 id="jak-skonfigurować-spring-boot-layered-jar">Jak skonfigurować Spring Boot layered jar?</h2>
<ol>
  <li>Modyfikujemy sposób budowania aplikacji:
    <ul>
      <li>Dla budowania Gradle w zadaniach budujących naszą aplikację dodajemy:
        <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">tasks</span> <span class="p">{</span>
   <span class="nf">bootJar</span> <span class="p">{</span>
       <span class="n">layered</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>Dla budowania Mavenem, w konfiguracji plugina spring-boot-maven-plugin, dodajemy:
        <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;layers&gt;</span>
          <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
          <span class="nt">&lt;includeLayerTools&gt;</span>true<span class="nt">&lt;/includeLayerTools&gt;</span>
        <span class="nt">&lt;/layers&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
 <span class="nt">&lt;/build&gt;</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Modyfikujemy sposób budowania obrazu w pliku Dockerfile:
    <ul>
      <li>Przykładowy plik wygląda następująco:
        <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code> FROM eclipse-temurin:17.0.9_9-jre-alpine as builder
 WORKDIR /work
 COPY dockerfile-example-snapshot.jar application.jar
 RUN java -Djarmode=layertools -jar application.jar extract
 FROM eclipse-temurin:17.0.9_9-jre-alpine
 WORKDIR /app
 COPY --from=builder /work/dependencies/ ./
 COPY --from=builder /work/spring-boot-loader/ ./
 COPY --from=builder /work/snapshot-dependencies/ ./
 COPY --from=builder /work/application/ ./
 CMD ["java", "org.springframework.boot.loader.launch.JarLauncher"]
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<p>Jak widać wyżej, budowanie zostało podzielone na dwa etapy:</p>
<ol>
  <li>Skopiowanie oraz wypakowanie pliku .jar</li>
  <li>Skopiowanie warstw pliku .jar oraz zadeklarowanie polecenia, które zostanie wykonane przy starcie kontenera</li>
</ol>

<h2 id="zastosowanie-w-praktyce">Zastosowanie w praktyce</h2>
<p>Do zaprezentowania działania wykorzystajmy przykładowy plik Dockerfile wskazany powyżej.</p>
<ol>
  <li>Budujemy obraz:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nb">.</span> <span class="nt">--tag</span> service1
</code></pre></div>    </div>
  </li>
  <li>Wykonujemy polecenie listujące warstwy:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">history </span>service1
</code></pre></div>    </div>
  </li>
  <li>Rezultat polecenia:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IMAGE          CREATED              CREATED BY                                      SIZE
a59bcc935804   About a minute ago   /bin/sh -c #(nop) CMD ["java" "org.s…           0B
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:bdb78666255cc63e7…   3.71kB
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:f782fe956cf5892f5…   0B  
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:3d769b9b5528fa54f…   387kB
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:24195f786b612de17…   19.5MB
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) WORKDIR /app                  0B
&lt;​missing&gt;      8 days ago           ENTRYPOINT ["/__cacert_entrypoint.sh"]          0B
&lt;​missing&gt;      8 days ago           COPY entrypoint.sh /__cacert_entrypoint.sh #…   1.17kB
&lt;​missing&gt;      8 days ago           RUN /bin/sh -c set -eux;     echo "Verifying…   0B
&lt;​missing&gt;      8 days ago           RUN /bin/sh -c set -eux;     ARCH="$(apk --p…   140MB
&lt;​missing&gt;      8 days ago           ENV JAVA_VERSION=jdk-17.0.11+9                  0B
&lt;​missing&gt;      8 days ago           RUN /bin/sh -c set -eux;     apk add --no-ca…   17.3MB
&lt;​missing&gt;      8 days ago           ENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_AL…   0B
&lt;​missing&gt;      8 days ago           ENV PATH=/opt/java/openjdk/bin:/usr/local/sb…   0B
&lt;​missing&gt;      8 days ago           ENV JAVA_HOME=/opt/java/openjdk                 0B
&lt;​missing&gt;      3 months ago         /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B
&lt;​missing&gt;      3 months ago         /bin/sh -c #(nop) ADD file:37a76ec18f9887751…   7.37MB
</code></pre></div>    </div>
  </li>
  <li>Wykonujemy zmianę kodu źródłowego aplikacji i ponownie budujemy obraz z nowym tagiem:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nb">.</span> <span class="nt">--tag</span> service2
</code></pre></div>    </div>
  </li>
  <li>Wykonujemy polecenie listujące warstwy:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker history service2
</code></pre></div>    </div>
  </li>
  <li>Rezultat polecenia:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IMAGE          CREATED          CREATED BY                                      SIZE
e027785c6f71   34 seconds ago   /bin/sh -c #(nop) CMD ["java" "org.s…           0B
&lt;​missing&gt;      34 seconds ago   /bin/sh -c #(nop) COPY dir:0c4cebea0bf1ba4e8…   3.7kB
&lt;​missing&gt;      2 minutes ago    /bin/sh -c #(nop) COPY dir:f782fe956cf5892f5…   0B
&lt;​missing&gt;      2 minutes ago    /bin/sh -c #(nop) COPY dir:3d769b9b5528fa54f…   387kB
&lt;​missing&gt;      2 minutes ago    /bin/sh -c #(nop) COPY dir:24195f786b612de17…   19.5MB
&lt;​missing&gt;      2 minutes ago    /bin/sh -c #(nop) WORKDIR /app                  0B
&lt;​missing&gt;      8 days ago       ENTRYPOINT ["/__cacert_entrypoint.sh"]          0B
&lt;​missing&gt;      8 days ago       COPY entrypoint.sh /__cacert_entrypoint.sh #…   1.17kB
&lt;​missing&gt;      8 days ago       RUN /bin/sh -c set -eux;     echo "Verifying…   0B
&lt;​missing&gt;      8 days ago       RUN /bin/sh -c set -eux;     ARCH="$(apk --p…   140MB
&lt;​missing&gt;      8 days ago       ENV JAVA_VERSION=jdk-17.0.11+9                  0B
&lt;​missing&gt;      8 days ago       RUN /bin/sh -c set -eux;     apk add --no-ca…   17.3MB
&lt;​missing&gt;      8 days ago       ENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_AL…   0B
&lt;​missing&gt;      8 days ago       ENV PATH=/opt/java/openjdk/bin:/usr/local/sb…   0B
&lt;​missing&gt;      8 days ago       ENV JAVA_HOME=/opt/java/openjdk                 0B
&lt;​missing&gt;      3 months ago     /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B
&lt;​missing&gt;      3 months ago     /bin/sh -c #(nop) ADD file:37a76ec18f9887751…   7.37MB
</code></pre></div>    </div>
  </li>
</ol>

<p>Na powyższym przykładzie widzimy, że zależności naszej aplikacji ważą około 20 MB. Przy wykonywaniu drugiego obrazu warstwa zależności została pobrana z cache, dzięki czemu wykorzystaliśmy 20 MB zamiast 40 MB.</p>

<h2 id="definiowanie-własnych-warstw-zależności">Definiowanie własnych warstw zależności</h2>

<p>Jeżeli domyślna konfiguracja warstw nie jest wystarczająca, to możemy określić własne warstwy, zawierające konkretne zależności. Pozwoli to wydzielić podstawowe zależności, które są na przykład wykorzystane w kilku projektach.</p>

<h3 id="konfiguracja">Konfiguracja</h3>
<p>W powyższym przykładzie wydzielimy zależności pakietu javax.xml.bind do osobnej warstwy.</p>

<h4 id="maven">Maven</h4>
<ol>
  <li>W katalogu <code class="language-plaintext highlighter-rouge">/src/resources</code> tworzymy plik <code class="language-plaintext highlighter-rouge">layers.xml</code> określający strukturę warstw naszego pliku .jar:</li>
</ol>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;layers</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/boot/layers"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/boot/layers
        https://www.springframework.org/schema/boot/layers/layers-{spring-boot-xsd-version}.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;application&gt;</span>
        <span class="nt">&lt;into</span> <span class="na">layer=</span><span class="s">"spring-boot-loader"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;include&gt;</span>org/springframework/boot/loader/**<span class="nt">&lt;/include&gt;</span>
        <span class="nt">&lt;/into&gt;</span>
        <span class="nt">&lt;into</span> <span class="na">layer=</span><span class="s">"application"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/application&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;into</span> <span class="na">layer=</span><span class="s">"jaxb-dependencies"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;include&gt;</span>javax.xml.bind:*:*<span class="nt">&lt;/include&gt;</span>
        <span class="nt">&lt;/into&gt;</span>
        <span class="nt">&lt;into</span> <span class="na">layer=</span><span class="s">"snapshot-dependencies"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;include&gt;</span>*:*:*SNAPSHOT<span class="nt">&lt;/include&gt;</span>
        <span class="nt">&lt;/into&gt;</span>
        <span class="nt">&lt;into</span> <span class="na">layer=</span><span class="s">"dependencies"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;layerOrder&gt;</span>
        <span class="nt">&lt;layer&gt;</span>dependencies<span class="nt">&lt;/layer&gt;</span>
        <span class="nt">&lt;layer&gt;</span>spring-boot-loader<span class="nt">&lt;/layer&gt;</span>
        <span class="nt">&lt;layer&gt;</span>jaxb-dependencies<span class="nt">&lt;/layer&gt;</span>
        <span class="nt">&lt;layer&gt;</span>snapshot-dependencies<span class="nt">&lt;/layer&gt;</span>
        <span class="nt">&lt;layer&gt;</span>application<span class="nt">&lt;/layer&gt;</span>
    <span class="nt">&lt;/layerOrder&gt;</span>
<span class="nt">&lt;/layers&gt;</span>
</code></pre></div></div>

<p>Należy pamiętać, aby przy konfiguracji pliku <code class="language-plaintext highlighter-rouge">layers.xml</code> uzupełnić wersję zapisaną pod zmienną <em>spring-boot-xsd-version</em></p>

<ol>
  <li>W konfiguracji plugina tworzącego warstwowy .jar wskazujemy plik z konfiguracją warstw:</li>
</ol>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;layers&gt;</span>
            <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>${project.basedir}/src/resources/layers.xml<span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/layers&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>

<h4 id="gradle">Gradle</h4>
<ol>
  <li>Konfigurujemy plugin, określając nowe warstwy. W pliku <code class="language-plaintext highlighter-rouge">build.gradle.kts</code> umieszczamy:
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">tasks</span> <span class="p">{</span>
 <span class="nf">bootJar</span> <span class="p">{</span>
     <span class="nf">layered</span> <span class="p">{</span>
         <span class="nf">application</span> <span class="p">{</span>
             <span class="nf">intoLayer</span><span class="p">(</span><span class="s">"spring-boot-loader"</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nf">include</span><span class="p">(</span><span class="s">"org/springframework/boot/loader/**"</span><span class="p">)</span>
             <span class="p">}</span>
             <span class="nf">intoLayer</span><span class="p">(</span><span class="s">"application"</span><span class="p">)</span>
         <span class="p">}</span>
         <span class="nf">dependencies</span> <span class="p">{</span>
             <span class="nf">intoLayer</span><span class="p">(</span><span class="s">"jaxb-dependencies"</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nf">include</span><span class="p">(</span> <span class="s">"javax.xml.bind:*:*"</span><span class="p">)</span>
             <span class="p">}</span>
             <span class="nf">intoLayer</span><span class="p">(</span><span class="s">"snapshot-dependencies"</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nf">include</span><span class="p">(</span><span class="s">"*:*:*SNAPSHOT"</span><span class="p">)</span>
             <span class="p">}</span>
             <span class="nf">intoLayer</span><span class="p">(</span><span class="s">"dependencies"</span><span class="p">)</span>
         <span class="p">}</span>
         <span class="n">layerOrder</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"dependencies"</span><span class="p">,</span> <span class="s">"spring-boot-loader"</span><span class="p">,</span> <span class="s">"jaxb-dependencies"</span><span class="p">,</span> <span class="s">"snapshot-dependencies"</span><span class="p">,</span> <span class="s">"application"</span><span class="p">)</span>
     <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <p>W pliku <code class="language-plaintext highlighter-rouge">Dockerfile</code> dodajemy kopiowanie nowej warstwy:</p>
    <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> eclipse-temurin:17.0.11_9-jre-alpine as builder</span>
<span class="k">WORKDIR</span><span class="s"> /work</span>
<span class="k">COPY</span><span class="s"> dockerfile-example-snapshot.jar application.jar</span>
<span class="k">RUN </span>java <span class="nt">-Djarmode</span><span class="o">=</span>layertools <span class="nt">-jar</span> application.jar extract
<span class="k">FROM</span><span class="s"> eclipse-temurin:17.0.11_9-jre-alpine</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=builder /work/dependencies/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /work/spring-boot-loader/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /work/jaxb-dependencies/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /work/snapshot-dependencies/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /work/application/ ./</span>
<span class="k">CMD</span><span class="s"> ["java", "org.springframework.boot.loader.launch.JarLauncher"]</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="rezultat">Rezultat</h3>
<ol>
  <li>Budujemy obraz:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nb">.</span> <span class="nt">--tag</span> service1
</code></pre></div>    </div>
  </li>
  <li>Wykonujemy polecenie listujące warstwy:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">history </span>service1
</code></pre></div>    </div>
  </li>
  <li>Rezultat polecenia:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IMAGE          CREATED              CREATED BY                                      SIZE
53a56b52bb9d   About a minute ago   /bin/sh -c #(nop) CMD ["java" "org.s…           0B
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:dd5854b870089072a…   6.32kB
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:f782fe956cf5892f5…   0B
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:a0166562a093edeb6…   128kB
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:3d769b9b5528fa54f…   387kB
&lt;​missing&gt;      About a minute ago   /bin/sh -c #(nop) COPY dir:5e9e8ed2b7656fb9f…   19.6MB
&lt;​missing&gt;      About an hour ago    /bin/sh -c #(nop) WORKDIR /app                  0B
&lt;​missing&gt;      8 days ago           ENTRYPOINT ["/__cacert_entrypoint.sh"]          0B
&lt;​missing&gt;      8 days ago           COPY entrypoint.sh /__cacert_entrypoint.sh #…   1.17kB
&lt;​missing&gt;      8 days ago           RUN /bin/sh -c set -eux;     echo "Verifying…   0B
&lt;​missing&gt;      8 days ago           RUN /bin/sh -c set -eux;     ARCH="$(apk --p…   140MB
&lt;​missing&gt;      8 days ago           ENV JAVA_VERSION=jdk-17.0.11+9                  0B
&lt;​missing&gt;      8 days ago           RUN /bin/sh -c set -eux;     apk add --no-ca…   17.3MB
&lt;​missing&gt;      8 days ago           ENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_AL…   0B
&lt;​missing&gt;      8 days ago           ENV PATH=/opt/java/openjdk/bin:/usr/local/sb…   0B
&lt;​missing&gt;      8 days ago           ENV JAVA_HOME=/opt/java/openjdk                 0B
&lt;​missing&gt;      3 months ago         /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B
&lt;​missing&gt;      3 months ago         /bin/sh -c #(nop) ADD file:37a76ec18f9887751…   7.37MB
</code></pre></div>    </div>
  </li>
  <li>Wykonujemy zmianę wersji zależności z pakietu jaxb.xml.bind i ponownie budujemy obraz z nowym tagiem:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nb">.</span> <span class="nt">--tag</span> service2
</code></pre></div>    </div>
  </li>
  <li>Wykonujemy polecenie listujące warstwy:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">history </span>service2
</code></pre></div>    </div>
  </li>
  <li>Rezultat polecenia:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IMAGE          CREATED             CREATED BY                                      SIZE
0a6326aaf0a6   27 seconds ago      /bin/sh -c #(nop) CMD ["java" "org.s…           0B
&lt;​missing&gt;      27 seconds ago      /bin/sh -c #(nop) COPY dir:67d2736e371ec6127…   6.22kB
&lt;​missing&gt;      27 seconds ago      /bin/sh -c #(nop) COPY dir:f782fe956cf5892f5…   0B
&lt;​missing&gt;      27 seconds ago      /bin/sh -c #(nop) COPY dir:d10e5e52a40c11567…   126kB
&lt;​missing&gt;      About an hour ago   /bin/sh -c #(nop) COPY dir:3d769b9b5528fa54f…   387kB
&lt;​missing&gt;      About an hour ago   /bin/sh -c #(nop) COPY dir:24195f786b612de17…   19.5MB
&lt;​missing&gt;      About an hour ago   /bin/sh -c #(nop) WORKDIR /app                  0B
&lt;​missing&gt;      8 days ago          ENTRYPOINT ["/__cacert_entrypoint.sh"]          0B
&lt;​missing&gt;      8 days ago          COPY entrypoint.sh /__cacert_entrypoint.sh #…   1.17kB
&lt;​missing&gt;      8 days ago          RUN /bin/sh -c set -eux;     echo "Verifying…   0B
&lt;​missing&gt;      8 days ago          RUN /bin/sh -c set -eux;     ARCH="$(apk --p…   140MB
&lt;​missing&gt;      8 days ago          ENV JAVA_VERSION=jdk-17.0.11+9                  0B
&lt;​missing&gt;      8 days ago          RUN /bin/sh -c set -eux;     apk add --no-ca…   17.3MB
&lt;​missing&gt;      8 days ago          ENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_AL…   0B
&lt;​missing&gt;      8 days ago          ENV PATH=/opt/java/openjdk/bin:/usr/local/sb…   0B
&lt;​missing&gt;      8 days ago          ENV JAVA_HOME=/opt/java/openjdk                 0B
&lt;​missing&gt;      3 months ago        /bin/sh -c #(nop)  CMD ["/bin/sh"]              0B
&lt;​missing&gt;      3 months ago        /bin/sh -c #(nop) ADD file:37a76ec18f9887751…   7.37MB
</code></pre></div>    </div>
  </li>
</ol>

<p>Widzimy, że podczas tworzenia nowej wersji obrazu cztery ostatnie operacje zostały wykonane ponownie, a operacja kopiowania pozostałych zależności została wykorzystana z cache.</p>

<h2 id="podsumowanie">Podsumowanie</h2>
<p>Warstwowe budowanie plików .jar może znacznie zmniejszyć wykorzystanie pamięci dyskowej, w której przechowujemy gotowe obrazy Docker. Warto pamiętać o prawidłowej kolejności operacji w pliku Dockerfile oraz o możliwości definiowania własnych warstw zależności.</p>

                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-desktop">
                
<div class="sidebar-container latest-posts">
    <div class="sidebar-title">
        Newest posts
    </div>
    <hr class="latest-posts-separator">
    <div class="sidebar-latest-posts-container">
        <ul class="sidebar-posts"><li class="sidebar-post no-breaking-word star-icon">
                <a href="/en/2021/09/13/kafka-retry-dlq.html" lang="pl">Reliable event delivery in Apache Kafka based on retry and DLQ</a>
            </li><li class="sidebar-post no-breaking-word star-icon">
                <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html" lang="pl">Event Tracking - finding a needle in a haystack</a>
            </li><li class="sidebar-post no-breaking-word star-icon">
                <a href="/en/2021/08/30/kouncil-introduction.html" lang="pl">Kouncil - a modern Kafka frontend</a>
            </li></ul>
    </div>
</div>

                <div class="sidebar-container offers" id="offers-sidebar">
    <div class="sidebar-title offers-title">
        Join us
    </div>
    <hr class="offers-separator">
    <ul class="sidebar-posts offers-list">
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/senior-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">SENIOR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 14 900 - 20 590 PLN brutto <br/>
                            B2B 19 680 - 27 220 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/regular-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">REGULAR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 11 300 - 15 900 PLN brutto <br/>
                            B2B 14 950 - 21 000 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a class="clickable-offer" href="https://www.consdata.com/pl/kariera/trwajace-rekrutacje#tag-developer">
                <div class="other-job-offers">
                    <span class="job-title">ZOBACZ WSZYSTKIE OGŁOSZENIA</span>
                </div>
            </a>
        </li>
    </ul>
</div>

                
<div class="sidebar-container newsletter-sidebar-tile">
    <div class="newsletter-tile-title-container">
        
        <h2 class="newsletter-tile-title">technical</h2>
        <h2 class="newsletter-tile-title">newsletter</h2>
    
    </div>
    <a href="#newsletter-form" class="sign-up-btn">Sign up</a>
</div>

            </div>
        </div>
        <div class="recommended-container" id="recommended-posts-container">
    <h2 class="title">
        Podobne wpisy
    </h2>
    <div id="latest-posts-container" class="latest-posts-container">



<div class="post-tile">
    <a class="small-post-image" href="/en/2021/09/13/kafka-retry-dlq.html">
        <img class="tile-image small-post-image" src="/assets/img/posts/2021-09-13-kafka-retry-dlq/thumbnail.webp" alt="post-image"/>
    </a>
    <div class="post-tile-content">
        <div class="badge-panel">
            <div class="badge">kouncil</div>
        </div>
        <h4 class="post-title no-breaking-word">
            <a href="/en/2021/09/13/kafka-retry-dlq.html">Reliable event delivery in Apache Kafka based on retry and DLQ</a>
        </h4>

        <p class="post-description no-breaking-word">
            <a href="/en/2021/09/13/kafka-retry-dlq.html">
                
                Why is there no DLQ in Kafka? Most popular queueing systems such as RabbitMQ or ActiveMQ have built-in systems responsible for reliable message delivery. So why doesn't Kafka offer one?...
                
            </a>
        </p>

        <div class="tile-author"><a href="/en/authors/jgrobelny.html" class="author-name author-img">
                <img class="small-author-image" src="/assets/img/authors/jgrobelny.webp" alt="author">
            </a>
            <div class="post-info">
                <a href="/en/authors/jgrobelny.html" class="author-name">Jacek Grobelny</a>
                <span class="post-date">
13


Sep


2021
</span>
            </div></div>
    </div>
</div>




<div class="post-tile">
    <a class="small-post-image" href="/en/2021/09/08/kouncil-event-tracking-kafka.html">
        <img class="tile-image small-post-image" src="/assets/img/posts/2021-09-08-kouncil-event-tracking-kafka/thumbnail.webp" alt="post-image"/>
    </a>
    <div class="post-tile-content">
        <div class="badge-panel">
            <div class="badge">kouncil</div>
        </div>
        <h4 class="post-title no-breaking-word">
            <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html">Event Tracking - finding a needle in a haystack</a>
        </h4>

        <p class="post-description no-breaking-word">
            <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html">
                
                Event tracking allows for tracking and visualising the path of a given event or process through Kafka topics.
                
            </a>
        </p>

        <div class="tile-author"><a href="/en/authors/mmergo.html" class="author-name author-img">
                <img class="small-author-image" src="/assets/img/authors/mmergo.webp" alt="author">
            </a>
            <div class="post-info">
                <a href="/en/authors/mmergo.html" class="author-name">Marcin Mergo</a>
                <span class="post-date">
8


Sep


2021
</span>
            </div></div>
    </div>
</div>




<div class="post-tile">
    <a class="small-post-image" href="/en/2021/08/30/kouncil-introduction.html">
        <img class="tile-image small-post-image" src="/assets/img/posts/2021-08-30-kouncil-introduction/thumbnail.webp" alt="post-image"/>
    </a>
    <div class="post-tile-content">
        <div class="badge-panel">
            <div class="badge">kouncil</div>
        </div>
        <h4 class="post-title no-breaking-word">
            <a href="/en/2021/08/30/kouncil-introduction.html">Kouncil - a modern Kafka frontend</a>
        </h4>

        <p class="post-description no-breaking-word">
            <a href="/en/2021/08/30/kouncil-introduction.html">
                
                Kouncil is a modern Kafka frontend equipped with features essential for developers.
                
            </a>
        </p>

        <div class="tile-author"><a href="/en/authors/jgrobelny.html" class="author-name author-img">
                <img class="small-author-image" src="/assets/img/authors/jgrobelny.webp" alt="author">
            </a>
            <div class="post-info">
                <a href="/en/authors/jgrobelny.html" class="author-name">Jacek Grobelny</a>
                <span class="post-date">
30


Aug


2021
</span>
            </div></div>
    </div>
</div>
</div>
    <img id="arrow-icon" onclick="toggleRecommendation()" class="arrow rotated" src="/assets/icon/arrow.svg">
</div>

<script>

    let expended = false;
    const arrowIcon = document.getElementById("arrow-icon")

    function toggleRecommendation() {
        if (expended) {
            document.getElementById("latest-posts-container").classList.remove("hide");
            arrowIcon.classList.add("rotated");
        } else {
            document.getElementById("latest-posts-container").classList.add("hide");
            arrowIcon.classList.remove("rotated");
        }
        
        expended = !expended;
    }

</script>

        <div class="consdata-offers-mobile">
            <div class="sidebar-container offers" id="offers-sidebar">
    <div class="sidebar-title offers-title">
        Join us
    </div>
    <hr class="offers-separator">
    <ul class="sidebar-posts offers-list">
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/senior-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">SENIOR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 14 900 - 20 590 PLN brutto <br/>
                            B2B 19 680 - 27 220 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/regular-fullstack-developer-java-angular"
               lang="pl">
                <div class="job-offer">
                    <span class="job-title">REGULAR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                    <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                    <span class="job-salary">
                            UoP 11 300 - 15 900 PLN brutto <br/>
                            B2B 14 950 - 21 000 PLN netto
                        </span>
                </div>
            </a>
        </li>
        <li class="sidebar-post no-breaking-word">
            <a class="clickable-offer" href="https://www.consdata.com/pl/kariera/trwajace-rekrutacje#tag-developer">
                <div class="other-job-offers">
                    <span class="job-title">ZOBACZ WSZYSTKIE OGŁOSZENIA</span>
                </div>
            </a>
        </li>
    </ul>
</div>

        </div>
        <div class="newsletter-sub-container" id="newsletter-sub-container">
    <div class="title">
        
        <h2>Sign up for a </h2>
        <h2>technical </h2>
        <h2 class="newsletter">newsletter</h2>
        
    </div>
    <div id="newsletter-form" class="newsletter-agreement-form-content">
        <form class="newsletter-form" action="https://app2.salesmanago.pl/form/e7yrrpjmxbm7bahc/contact.htm" method="post" target="_blank" onsubmit="">
            <input type="hidden" name="lang" value="pl">
            <input type="hidden" name="formId" value="fe234ba7-932a-438e-aca0-0cf324930910">
            <input type="hidden" value="true" name="sm-form-consent-id-2634-NEWSLETTER_JAVA">
            <div class="form-inputs">
                <input required placeholder="Name *" name="sm-form-name"/>
                <input required type="email" placeholder="E-mail" name="sm-form-email"/>
            </div>
            <div class="form-checkbox-container">
                <label class="form-checkbox">
                    <input required type="checkbox" name="sm-form-consent-name-NEWSLETTER_JAVA"/>
                    <div class="form-checkbox-input"></div>
                    <span>By submitting the form, you consent to the processing of your data in accordance with the Privacy Policy*.</span>
                </label>
            </div>
            <button class="sign-up-btn">Sign up</button>
        </form>
    </div>
</div>

    </article>
</div>
<script>
    const language = 'en';
    const jsonPath = language === 'en' ? '/en/json/posts.json' : '/json/posts.json';
    fetch(jsonPath)
        .then(response => response.json())
        .then(store => {
            function displayResults(results) {
                if (results.length > 0) {
                    const container = document.getElementById("recommended-posts");
                    results
                        .forEach(result => {
                            const item = store[result.ref];
                            if (item.lang === language) {
                                const listElement = document.createElement('li');
                                const anchor = document.createElement('a');
                                const postTitle = document.createTextNode(item.title);
                                listElement.classList.add('sidebar-post');
                                listElement.classList.add('no-breaking-word');
                                anchor.setAttribute('href', item.url);
                                anchor.setAttribute('lang', 'pl');
                                anchor.appendChild(postTitle);
                                listElement.appendChild(anchor);
                                container.appendChild(listElement);
                            }
                        });
                    if (container.children.length < 1) {
                        hideRecommendedPosts();
                    }
                } else {
                    hideRecommendedPosts();
                }

            }

            const tags = "spring boot java gradle maven docker";
            const idx = lunr(function () {
                this.field('tags');

                for (let key in store) {
                    this.add({
                        'id': key,
                        'title': store[key].title,
                        'tags': store[key].tags,
                    });
                }
            });
            const results = idx.search(tags).slice(1, 4);
            displayResults(results);
        })

    function hideRecommendedPosts() {
        document.getElementById("recommended-posts-container").style.display = 'none';
    }
</script>

</main><footer>
    <div class="container">
        <a class="footer-logo" href="https://consdata.com/pl">
            <img src="/assets/img/logo.png" alt="consdata.com">
        </a>
        <div class="footer-content">
            <div class="footer-menu">
                <ul class="menu">
                    <li class="menu-item">
                        <p class="menu-title">Contact</p>
                        <ul class="submenu">
                            <li>
                                <a href="mailto:sales@consdata.com">sales@consdata.com</a>
                            </li>
                            <li>
                                <p>+48 61 41 51 000</p>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <p class="menu-title">Office</p>
                        <ul class="submenu">
                            <li>
                                <p>K9Office<br>Krysiewicza 9/14<br>61-825 Poznań<br>Polska</p>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <p class="menu-title">Solutions</p>
                        <ul class="submenu">
                            <li>
                                <a href="https://eximee.com" target="_blank">Eximee</a>
                            </li>
                            <li>
                                <a href="https://kouncil.io" target="_blank">Kouncil</a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="/en/" class="menu-title">Blog</a>
                        <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje" class="menu-title"
                           target="_blank">Join us</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="small-footer-container">
        <div class="footer-copyright">
            <span>Copyright © 2024 Consdata. All rights reserved.</span>
            <span>
                <a href="https://consdata.com/pl/polityka-prywatnosci"
                     class="privacy-policy">Privacy Policy & Cookies</a>
            </span>
        </div>
        <div class="social-footer">
            <a target="_blank" href="https://www.facebook.com/consdatacom">
                <img class="icon" src="/assets/icon/social-f.svg">
            </a>
            <a target="_blank" href="https://www.linkedin.com/company/consdata">
                <img class="icon" src="/assets/icon/social-in.svg">
            </a>
            <a target="_blank" href="https://github.com/Consdata">
                <img class="icon" src="/assets/icon/github.svg">
            </a>
            <a target="_blank" href="https://forum.eximee.com/">
                <img class="icon" src="/assets/icon/social-icon.svg">
            </a>
        </div>
    </div>
</footer>
<div class="cookie-notice" id="cookie-notice">
    <i onclick="hideConsent()" class="close-consent fa fa-times close"></i>
    <div class="cookie-container">
        <span>
            
            Chcemy używać plików cookie oraz skryptów podmiotów trzecich do polepszania funkcjonowania tej strony
        </span>
        <a id="cookie-notice-accept" class="consent-button">Zgadzam się</a>
    </div>
        <noscript><img height="1" width="1" style="display:none"
                   src="https://www.facebook.com/tr?id=300808861525851&ev=PageView&noscript=1"
    /></noscript>
</div>

<script>
    function createCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    function readCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function eraseCookie(name) {
        createCookie(name, "", -1);
    }

    function hideConsent() {
        document.getElementById('cookie-notice').style.display = 'none';
    }

    if (readCookie('cookie-notice-dismissed') === 'true') {!function (f, b, e, v, n, t, s) {
    if (f.fbq) return;
    n = f.fbq = function () {
        n.callMethod ?
            n.callMethod.apply(n, arguments) : n.queue.push(arguments)
    };
    if (!f._fbq) f._fbq = n;
    n.push = n;
    n.loaded = !0;
    n.version = '2.0';
    n.queue = [];
    t = b.createElement(e);
    t.async = !0;
    t.src = v;
    s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s)
}(window, document, 'script',
    'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '300808861525851');
fbq('track', 'PageView');
} else {
        document.getElementById('cookie-notice').style.display = 'flex';
    }

    document.getElementById('cookie-notice-accept').addEventListener("click", function () {
        createCookie('cookie-notice-dismissed', 'true', 31);
        hideConsent();
        location.reload();
    });
</script>

</body>
</html>
